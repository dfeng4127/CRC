library(Seurat)
library(SeuratData)
library(ggplot2)
library(patchwork)
library(dplyr)
library(RColorBrewer)
setwd('./ST2')  # same for all sample
ST2 <- Load10X_Spatial(
  "./",
  filename = "filtered_feature_bc_matrix.h5",
  assay = "Spatial",
  slice = "slice1")

plot1 <- VlnPlot(ST2, features = "nCount_Spatial", pt.size = 0.1) + NoLegend()
plot2 <- SpatialFeaturePlot(ST2, features = "nCount_Spatial") + theme(legend.position = "right")
wrap_plots(plot1, plot2)

# sctransform
ST2 <- SCTransform(ST2, assay = "Spatial", verbose = FALSE)

# Dimensionality reduction, clustering, and visualization
ST2 <- RunPCA(ST2, assay = "SCT", verbose = FALSE)
ST2 <- FindNeighbors(ST2, reduction = "pca", dims = 1:30)
ST2 <- FindClusters(ST2, verbose = FALSE)
ST2 <- RunUMAP(ST2, reduction = "pca", dims = 1:30)
p1 <- DimPlot(ST2, reduction = "umap", label = TRUE)
p2 <- SpatialDimPlot(ST2, label = TRUE, label.size = 3)
p1 + p2
SpatialDimPlot(ST2, cells.highlight = CellsByIdentities(object = ST2, idents = c(1, 2, 3, 4)), 
               facet.highlight = TRUE, ncol = 2)

# Gene expression visualization
SpatialFeaturePlot(ST2, features = c("MUC2", "MYC"),alpha = c(0.1, 1))
p1 <- SpatialFeaturePlot(ST2, features = "MUC2", pt.size.factor = 1)
p2 <- SpatialFeaturePlot(ST2, features = "MYC", alpha = c(0.1, 1))
p1 + p2

